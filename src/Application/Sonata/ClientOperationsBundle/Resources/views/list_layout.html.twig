{% extends 'ApplicationSonataClientOperationsBundle::standard_layout.html.twig' %}

{% use 'ApplicationSonataClientOperationsBundle:CRUD:form_panels.html.twig' with form_panels as formPanels %}

{% block panel_block %}
    {{ block('formPanels')}}
{% endblock panel_block %}

{% block javascripts %}
{{parent()}}
<script type="text/javascript">
    $(function(){
        var $table = $('.sonata-ba-list .table tbody:first')
        var $tr = $table.find('tr:first').clone();

        //$tr.css('position', 'absolute');

        var add_total_rows = false;
        $tr.children().each(function(){
            $(this).removeAttr('objectid');
            var $div = $(this).children();
            if(!$div.hasClass('totals')) {
                $(this).html('&nbsp;');
            }
            else {
                add_total_rows = true;
                var tc = $div.removeClass('totals')
                        .attr("class");
                $div.attr("class", tc+'_total')

                var sum = 0;
                $('.' + tc).each(function(){
                    sum += parseFloat($(this).html());
                });
                $div.html('<b>Total: ' + sum + '</b>');
            }
        });

        if (add_total_rows) {
            $tr.appendTo($table);
        }
        else {
            $tr.remove();
        }
    });
    $(function(){
        var w = $('.sonata-ba-list table.table').width()+71;
        if (w > 110){
            $('#container').css('min-width', w+'px');
        }
    });
    {% if not admin.getLocking %}
        $(function(){
            var editObjectAbstractUrl = '{{ admin.generateUrl('edit', {'id':'__id__'}) }}';
            var $table = $('.sonata-ba-list .table tbody:first');
            $table.find('tr').css('cursor', 'pointer').click(function(){
                var objectid = $(this).children(':last').attr('objectid');
                if (objectid){
                    location.href = editObjectAbstractUrl.replace("__id__", objectid);
                }
            });
        });
    {% endif %}
</script>
{% endblock javascripts %}